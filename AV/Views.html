<html>
<body>
<h1>Architectural Views</h1>
<section>
<h1>Logical view</h1>
<p>The logical view for the Mercurial describes the functionality of the Mercurial system to the end-users. 
Mercurial is a modern distributed version control system(VCS) which is written in Python. 
The main advantage of distributed VCS is that it allows developers to push around and intergrate changes as the project
requires at each point of time. The logical view of the Mercurial can be briefly discussed as follows:
The Mercurial architecture consists of a large number of modules.Each module has its own repository.
The user can clone the repository to code the module. The end user can use several clones.
Modules have their own unit tests. So code tests have to pass (i.e. yield only successes) before the user repositories to be pushed into the files. 
A build server then tests again each push, because problems may appear (e.g. platform-compatibility, or missing files).
When a module is ready, it is pushed into the testing repository. In this repository, the QA tests the modules. 
Developers may code in this repository (mainly to fix bugs), but they should not add new features to the code.
If the test is successful then the user releases it by pushing it into the stable repository.</p>
</section>


<section><h1>Development view</h1>
<p>The development view for the Mercurail deals mainly with the software development and management.
We can also find few bits in C because they are critical to the performance of the system. 
A Python module correspoonds to a single file of code. Modules are the basic organizers for the source code. 
Mercurial contains a package known as _init_.py which exposes all modules and packages to the Python importer.
It also has two default packages called the 'mercurial' and 'hgext'. 
The 'mercurial'package contains the core code required to run Mercurial whereas 'hgext' contains a lrage number of extensions.
Mercurial can be basically categorized as a Command-line application.
One of the powerful features of Mercurial is the ability to write the extensions.
It is quite simple and easy to extend Mercurial beacuse of Python. 
other feature of Mercurial is 'Hooks'which provide a way to the VCS events to interact with the outside world.
There are two variants of hooks one is the traditional hook which invokes scripts in the shell. 
The other one is the Python hook which invokes Python module and a function name to call from that module.
In Mercurial, hooks are divided into four types:
<ol>
<li>pre-command</li>
<li>post-command</li>
<li>controlling</li>
<li>miscellaneous</li>
</ol>
</section>


<section><h1>Process view</h1>
<p>The process view of Mercurial depicts the interaction of processes or objects in runtime. When Mercurial 
tracks modifications to a file, it stores the history of that file in a metadata object called a 'filelog'. 
Mercurial uses a structure called a 'manifest' to collect together information about the files that it
tracks. Each entry in the manifest contains information about the files present in a single changeset.
The changelog contains information about each changeset. Within a changelog, a manifest, or a filelog,
each revision stores a pointer to its immediate parent (or to its two parents, if it's a merge revision).
For every changeset in a repository, there is exactly one revision stored in the changelog.
Each revision of the changelog contains a pointer to a single revision of the manifest. 
A revision of the manifest stores a pointer to a single revision of each filelog tracked when that 
changeset was created. The underpinnings of changelogs, manifests, and filelogs are provided by a single
structure called the revlog. Mercurial only ever appends data to the end of a revlog file. 
Mercurial treats every write as part of a transaction that can span a number of files. 
A transaction is atomic: either the entire transaction succeeds and its effects are all visible to readers 
in one go, or the whole thing is undone. This guarantee of atomicity means that if user is running two 
copies of Mercurial, where one is reading data and one is writing it, the reader will never see a partially 
written result that might confuse it. In the working directory, Mercurial stores a snapshot of the files 
from the repository as of a particular changeset. When user updates the working directory to contain a 
particular changeset, Mercurial looks up the appropriate revision of the manifest to find out which files 
it was tracking at the time that changeset was committed, and which revision of each file was then current. 
It then recreates a copy of each of those files, with the same contents it had when the changeset was 
committed.</p>
</section>

<section><h1>Physical view</h1>
<p>The physical view depicts the system concerned with the topology of software components. 
Since Mercurial can be seen as peer-to-peer application, each peer has the same structure as the other. 
Each peer represents a node which contains some layers. In general, no layer should know the details of any 
layer above it, and no layer should abuse the interface of layers below it. 
Interface layer is the topmost layer and is the part most directly exposed to the user. It contains 
commands.py, an implementation of the command line interface which contains most of the code that deals 
with converting commands into simple repository operations as well as the stdio push/pull interface, and 
hgweb.py, an implementation of the web interface which contains all the web and templating logic as well as 
the web based push/pull interface. The second one, Repository layer contains all the objects that implement 
the core primitives of the SCM such as commit, checkout/update/merge, push/pull, add/remove/copy, verify, 
and the proxy objects for remote repositories (remoterepository, sshrepository, httprepository, 
httpsrepository, statichttprepository) and the objects from which the repository is constructed (filelog, 
manifest, changeset, dirstate). The third one, Storage layer contains the basis for version storage, 
revlog. The fourth one, UI layer provides generic methods for communicating with the user and managing 
configuration info. The fifth layer, Utility layer includes generic functionality and platform abstraction.
</p></section>

<a ref="http://www.aosabook.org/">AOSA Book</a>
<a ref="http://en.wikipedia.org/">Wikipedia</a>
<a ref="http://hgbook.red-bean.com/read/behind-the-scenes.html#x8-640004">HG Book Chapter 4</a>
<a ref="http://mercurial.selenic.com/wiki/WhatGoesWhere">Mercurial Architecture</a> 
 


</body>
</html>
  
